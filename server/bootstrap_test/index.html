<!DOCTYPE html>
<html lang="ja">
<title>リモコン</title>
    <script language="javascript">
      var ws = new WebSocket("ws://192.168.1.32:8080/ws");
      //ws.onopen = function() {
        //ws.send("Hello, world");
      //};
      //ws.onmessage = function (evt) {
        //document.write("<strong>" + evt.data + "</strong>");
      //};
      function sendMessage(value) {
        ws.send(value);
      }

      function mergeSelectData(recipeId) {
        if (recipeId == "newRecipe") {
          var message = {
            recipeName : $("#recipeName").val(),
            thisData : $("#ifSelect option:selected").text(),
            thatData : $("#thenSelect option:selected").text()
          };
          ws.send(JSON.stringify(message));
        };
      }
    </script>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Bootstrap -->
    <link rel="stylesheet" href="{{ static_url("css/bootstrap.min.css") }}">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="row">
      <ul class="nav nav-tabs">
        <li class="active col-xs-6"><a href="#tab1" data-toggle="tab">TVリモコン</a></li>
        <li class="col-xs-6"><a href="#tab2" data-toggle="tab">レシピ</a></li>
      </ul>
    </div>

    <div class="tab-content">
      <!--TVリモコンタブ-->
      <div class="tab-pane active" id="tab1">
        <div class="row">
          <div class="col-sm-6">
            <p>
              <div class="col-xs-12"></div>
            </p>
            <p>
              <div class="col-xs-8"></div>
                <button type="button" onclick="sendMessage('power')" class="btn btn-danger col-xs-4">
                  <span class="glyphicon glyphicon-off" aria-hidden="true"></span>Power
                </button>
            </p>
            <p>
              <button type="button" onclick="sendMessage('1ch')" class="btn btn-default col-xs-4">1ch</button>
              <button type="button" onclick="sendMessage('2ch')" class="btn btn-default col-xs-4">2ch</button>
              <button type="button" onclick="sendMessage('3ch')" class="btn btn-default col-xs-4">3ch</button>
            </p>
            <p>
              <button type="button" onclick="sendMessage('4ch')" class="btn btn-default col-xs-4">4ch</button>
              <button type="button" onclick="sendMessage('5ch')" class="btn btn-default col-xs-4">5ch</button>
              <button type="button" onclick="sendMessage('6ch')" class="btn btn-default col-xs-4">6ch</button>
            </p>
            <p>
              <button type="button" onclick="sendMessage('7ch')" class="btn btn-default col-xs-4">7ch</button>
              <button type="button" onclick="sendMessage('8ch')" class="btn btn-default col-xs-4">8ch</button>
              <button type="button" onclick="sendMessage('9ch')" class="btn btn-default col-xs-4">9ch</button>
            </p>
            <p>
              <button type="button" onclick="sendMessage('10ch')" class="btn btn-default col-xs-4">10ch</button>
              <button type="button" onclick="sendMessage('11ch')" class="btn btn-default col-xs-4">11ch</button>
              <button type="button" onclick="sendMessage('12ch')" class="btn btn-default col-xs-4">12ch</button>
            </p>
          </div>
          <div class="col-sm-6">
            <p>
              <div class="col-xs-12"></div>
            </p>
            <p>
              <button type="button" onclick="sendMessage('ch_up')" class="btn btn-default col-xs-4">
                <span class="glyphicon glyphicon-triangle-top" aria-hidden="true"></span>UP
              </button>
              <div class="col-xs-4"></div>
              <button type="button" onclick="sendMessage('vol_up')" class="btn btn-default col-xs-4">
                <span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span>UP
              </button>
            </p>
            <p>
              <div class="col-xs-12"></div>
            </p>
            <p>
              <button type="button" onclick="sendMessage('ch_down')" class="btn btn-default col-xs-4">
                <span class="glyphicon glyphicon-triangle-bottom" aria-hidden="true"></span>DOWN
              </button>
              <div class="col-xs-4"></div>
              <button type="button" onclick="sendMessage('vol_down')" class="btn btn-default col-xs-4">
                <span class="glyphicon glyphicon-volume-down" aria-hidden="true"></span>DOWN
              </button>
            </p>
          </div>
        </div>
      </div>
      <!--レシピタブ-->
      <div class="tab-pane" id="tab2">
        <div class="row">
          <div class="col-xs-4"></div>
          <button type="button" class="btn btn-default col-xs-4">
            <a href="#" data-toggle="modal" data-target="#exampleModal" data-whatever="パラメーター１">
              <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>レシピ追加
            </a>
          </button>
          <div class="col-xs-4"></div>
        </div>
          <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&#215;</span><span class="sr-only">閉じる</span>
                  </button>
                  <h4 class="modal-title">レシピ追加</h4>
                </div><!-- /modal-header -->
                <div class="modal-body">
                  <input type="text" class="form-control" id="recipeName" placeholder="レシピ名">
                  <div class="row">
                    <div class="col-sm-6">
                      <h5 class="col-sm-2">If</h5>
                      <div class="col-sm-10">
                        <select class="form-control" id="ifSelect" value="-">
                          <option>-</option>
                          <option>人感センサが反応</option>
                          <option>温湿度センサが反応</option>
                          <option>光センサが反応</option>
                          <option>音センサが反応</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <h5 class="col-sm-2">then</h5>
                      <div class="col-sm-10">
                        <select class="form-control" id="thenSelect" value="-">
                          <option>-</option>
                          <option>テレビをON</option>
                          <option>モータを回す</option>
                          <option>LEDを点灯させる</option>
                          <option>音を鳴らす</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">キャンセル</button>
                  <button type="button" class="btn btn-primary" onclick="mergeSelectData('newRecipe')">保存</button>
                </div>
              </div>
            </div>
          </div>

          {% for title in titles %}
            <div class="row">
              <p>
                <div class="col-xs-4"></div>
                <div class="dropdown">
                  <button class="btn btn-success dropdown-toggle col-xs-4" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" onclick="  sendMessage('requestMessage{{ escape(title) }}')">
                    {{ escape(title) }}
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu pull-right" aria-labelledby="dropdownMenu1">
                    <li><a href="#" data-toggle="modal" data-target="#exampleModal{{ escape(title[0]) }}" data-whatever="パラメーター１">編集</a></li>
                    <li><a href="#">実行</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="#">削除</a></li>
                  </ul>
                </div>
                <div class="col-xs-4"></div>
              </p>
            </div>
            <div class="modal fade" id="exampleModal{{ escape(title[0]) }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                      <span aria-hidden="true">&#215;</span><span class="sr-only">閉じる</span>
                    </button>
                    <h4 class="modal-title">{{ escape(title) }}</h4>
                  </div><!-- /modal-header -->
                  <div class="modal-body">
                    <div class="row">
                      <div class="col-sm-6">
                        <h5 class="col-sm-2">If</h5>
                        <div class="col-sm-10">
                          <select class="form-control" id="ifSelect{{ escape(title[0]) }}">
                            <option>-</option>
                            <option>人感センサが反応</option>
                            <option>温湿度センサが反応</option>
                            <option>光センサが反応</option>
                            <option>音センサが反応</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <h5 class="col-sm-2">then</h5>
                        <div class="col-sm-10">
                          <select class="form-control" id="thenSelect{{ escape(title[0]) }}">
                            <option>-</option>
                            <option>テレビをON</option>
                            <option>モータを回す</option>
                            <option>LEDを点灯させる</option>
                            <option>音を鳴らす</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">キャンセル</button>
                    <button type="button" class="btn btn-primary">変更を保存</button>
                  </div>
                </div>
              </div>
            </div>
          {% end %}

          <script type="text/javascript">
            ws.onmessage = function (evt) {
              //var data = evt.data
              var data = JSON.parse(evt.data);
              //alert(data.age);
              document.getElementById('ifSelect' + data.recipeNum).value=data.thisData;
              document.getElementById('thenSelect' + data.recipeNum).value=data.thatData;
            };
          </script>
        </div>
      </div>
    </div>

    <header style="background-color: #777;" class="container">ヘッダー</header>
      <section class="container">
        <!-- Bootstrapのグリッドシステムclass="row"で開始 -->
        <div class="row">
          <!-- グリッドシステムとは：合計12分割 -->
          <div class="col-sm-6" style="background-color: blue;">青</div>
          <div class="col-sm-6" style="background-color: red;">赤</div>
        </div>
      </section>
    <footer style="background-color: #777;" class="container">フッター</footer>


            <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="{{ "https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js" }}"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="{{ static_url("js/bootstrap.min.js") }}"></script>
  </body>
</html>